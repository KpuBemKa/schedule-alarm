<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Alarm Schedule
  </title>
  <style>
   body {
    font-family: Arial, sans-serif;
    margin: 1rem;
}

@media (min-width: 920px) {
    body {
        max-width: 900px;
        margin: 1rem auto 1rem auto;
    }
}

button {
    font-size: 1rem;
    font-weight: bold;
}

#scheduleTable {
    margin: 2rem 0 1rem 0;
}

.d-center-header {
    text-align: center;
    margin: 5px 0 10px;
}

.d-hidden {
    display: none !important;
}

.d-row {
    display: flex;
    align-items: center;
    gap: 10px;
}

.d-schedule-rows-container {
    min-width: 400px;
}

.d-justify-end {
    justify-content: end;
}

.d-justify-space-between {
    justify-content: space-between;
}

.d-settings-content {
    max-width: 400px;
    margin: 0 auto 0 auto;

    .d-settings-row {
        margin-top: 1rem;
    }

    label {
        display: block;
    }

    input {
        padding: 5px;
        width: 100%;
        margin-top: 5px;
        box-sizing: border-box;
    }
}


.d-schedule-label {
    font-size: 1.15rem;
}

.d-button {
    font-size: 1em;
    padding: 0.5em 1em;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-family: inherit;
    background-color: #d7d7d7;
}

.d-margin-top-5 {
    margin-top: 5px;
}

.d-margin-top-10 {
    margin-top: 10px;
}

/* .d-position-relative {
    position: relative;
} */

.d-popup-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;

    .d-center-header {
        line-height: 2rem;
        margin: 0;
    }

    .d-schedule-wrapper {
        position: relative;
        max-width: 400px;
        background-color: white;
        border-radius: 5px;
        padding: 10px;

        .d-close-button {
            width: 2rem;
            height: 2rem;
            position: absolute;
            right: 0;
            top: 0;
            line-height: 2rem;
            box-sizing: border-box;
            text-align: center;
            padding: 0;
            font-weight: 900;
            font-size: 1.25rem;
            margin: 10px 10px 0 0;
        }
    }

    .d-bottom-buttons {
        display: flex;
        gap: 10px;

        button {
            flex: 0 0 100px;
        }
    }
}

.button-container {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 15px;
}

.form-select {
    padding: 0.25rem 1rem 0.25rem 1rem;
    font-size: 1rem;
}

.form-time {
    padding: 0.25rem;
    font-size: 1rem;
}

.base-button {
    padding: 0.5rem 1rem 0.5rem 1rem;
    font-size: 1rem;
    font-weight: bold;
}

.schedule-button {
    padding: 0.25rem 0.5rem 0.25rem 0.5rem;
    font-size: 1rem;
    margin-right: 1rem;
}

.delete-button {
    width: 2.25rem;
    height: 2.25rem;
    font-size: 1rem;
    font-weight: bold;
}

.top {
    display: flex;
    margin: 2rem 0 2rem 0;
}

.left {
    display: flex;
    flex-wrap: wrap;
    align-content: center;
    margin-right: auto;
}

.tabs {
    display: flex;
    border-bottom: 2px solid #ccc;
}

.tab {
    padding: 10px 20px;
    cursor: pointer;
    border: none;
    border-bottom: 2px solid transparent;
    background: none;
    font-size: 16px;
    width: 50%;
}

.tab.active {
    border-bottom: 2px solid #007bff;
    font-weight: bold;
    color: #007bff;
}

.tab-content {
    display: none;
    margin-top: 20px;
}

.tab-content.active {
    display: block;
}
  </style>
  <style>
   .c-schedule-container {
    margin: 1rem 0 0 0;
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: space-evenly;
}

.c-month {
    border: 1px solid #ccc;
    padding: 10px;
    width: 250px;
}

.c-month h3 {
    text-align: center;
    margin: 5px 0 10px;
}

.c-days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 2px;
}

.c-day,
.c-weekday {
    text-align: center;
    padding: 5px;
}

.c-weekday {
    font-weight: bold;
    background: #f0f0f0;
}

.c-day {
    cursor: pointer;
    border-radius: 3px;
}

.c-day:hover {
    background: #007bff;
    color: white;
}

.d-add-schedule-point {
    background-color: #25b261;
    color: white;
    font-weight: normal;
    height: 2rem;
    width: 2rem;
    padding: 0;
    margin: 0;
    font-size: 1.75rem;
}

.d-add-schedule-point:hover {
    background-color: #20a057;
}

.d-schedule-wrapper {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-width: 400px;
    margin: 0 auto;
    font-family: sans-serif;
    padding: 1.5rem 0;
}

.d-schedule-rows {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.d-schedule-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.d-schedule-row input[type="time"] {
    flex: 1 1 120px;
    padding: 0.3rem;
    font-size: 0.95rem;
    box-sizing: border-box;
    height: 2rem;
}

.d-schedule-row select {
    flex: 1 1 100px;
    padding: 0.3rem;
    font-size: 0.95rem;
    box-sizing: border-box;
    height: 2rem;
}

.d-schedule-row button {
    background-color: #e74c3c;
    color: white;
    padding: 0.3rem 0.6rem;
    /* border: none;
    cursor: pointer;
    font-size: 1rem;
    border-radius: 4px; */
}

.d-schedule-row button:hover {
    background-color: #c0392b;
}

.d-daily-schedule-wrapper>button {
    align-self: flex-start;
    background-color: #3498db;
    color: white;
    border: none;
    padding: 0.4rem 0.8rem;
    font-size: 1rem;
    border-radius: 4px;
    cursor: pointer;
}

.d-daily-schedule-wrapper>button:hover {
    background-color: #2980b9;
}


#popup {
    position: fixed;
    top: 20%;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    border: 2px solid #007bff;
    padding: 20px;
    display: none;
    z-index: 9999;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
}

#popup button {
    margin-top: 10px;
}
  </style>
 </head>
 <body>
  <div class="top">
   <div class="left">
    <span id="timeDisplay" style="font-weight: bold;">
     Loading...
    </span>
   </div>
  </div>
  <div>
   <div class="tabs">
    <button class="tab active" onclick="showTab('schedule')">
     Schedule
    </button>
    <button class="tab" onclick="showTab('settings')">
     Settings
    </button>
   </div>
   <div class="tab-content active" id="schedule">
    <form id="scheduleForm">
     <div class="d-row d-justify-space-between">
      <div>
       <label class="d-schedule-label" for="schedule_loop_type">
        Schedule loops:
       </label>
       <select class="form-select" id="schedule-loop-type" name="schedule_loop_type" onchange="scheduleTypeSelectChanged()" required="">
        <option value="daily">
         Daily
        </option>
        <option value="weekly">
         Weekly
        </option>
        <option value="monthly">
         Monthly
        </option>
        <option value="yearly">
         Yearly
        </option>
        <option value="custom">
         Custom range
        </option>
       </select>
      </div>
      <div>
       <button class="d-button" type="button">
        Upload
       </button>
       <button class="d-button" type="button">
        Refresh
       </button>
      </div>
     </div>
     <div id="d-schedule-views">
      <div class="d-yearly-view">
       <div class="c-schedule-container">
       </div>
      </div>
      <div class="d-monthly-view">
       <div class="c-schedule-container">
       </div>
      </div>
      <div class="d-weekly-view">
       <div class="c-schedule-container">
       </div>
      </div>
      <div class="d-daily-view">
       <div class="d-schedule-wrapper">
        <div>
         <div class="d-schedule-rows-container">
         </div>
         <div class="d-row d-justify-end d-margin-top-10">
          <button class="d-button d-add-schedule-point" onclick="createDailyScheduleRow(document.querySelector('.d-daily-view .d-schedule-rows-container'), 0, 0)" type="button">
           +
          </button>
         </div>
        </div>
       </div>
      </div>
      <div class="d-custom-view">
      </div>
     </div>
     <!-- <button type="button" onclick="addScheduleRow()" class="schedule-button">Add Row</button>
                <button type="button" onclick="submitSchedule()" class="schedule-button">Submit</button>
                <button type="button" onclick="fetchSchedule()" class="schedule-button">Load Schedule</button> -->
    </form>
   </div>
   <div class="tab-content" id="settings">
    <form id="settingsForm">
     <div class="d-settings-content">
      <div class="d-settings-row">
       <label for="wifi_ssid">
        Wi-Fi SSID:
       </label>
       <input id="wifi_ssid" name="wifi_ssid" required="" type="text"/>
      </div>
      <div class="d-settings-row">
       <label for="wifi_password">
        Wi-Fi Password:
       </label>
       <input id="wifi_password" name="wifi_password" type="text"/>
      </div>
      <div class="d-settings-row">
       <label for="remote_wifi_ssid">
        Remote Wi-Fi SSID:
       </label>
       <input id="remote_wifi_ssid" name="remote_wifi_ssid" type="text"/>
      </div>
      <div class="d-settings-row">
       <label for="remote_wifi_password">
        Remote Wi-Fi Password:
       </label>
       <input id="remote_wifi_password" name="remote_wifi_password" type="text"/>
      </div>
      <div class="d-settings-row">
       <label for="timezone">
        Timezone format:
       </label>
       <input id="timezone" name="timezone" type="text"/>
      </div>
      <div class="button-container">
       <button class="d-button" onclick="submitSettings()" type="button">
        Save Settings
       </button>
      </div>
     </div>
    </form>
   </div>
  </div>
  <!-- <div id="d-day-schedule-popup" class="d-popup-container d-hidden"> -->
  <div class="d-popup-container d-hidden" id="d-day-schedule-popup" onclick="if (event.target === event.currentTarget) closePopup()">
   <div class="d-schedule-wrapper">
    <div>
     <h3 class="d-center-header" id="popup-header">
      Day editor
     </h3>
    </div>
    <div>
     <div class="d-schedule-rows-container">
     </div>
     <div class="d-row d-margin-top-10 d-justify-end">
      <button class="d-button d-add-schedule-point" onclick="createDailyScheduleRow(document.querySelector('#d-day-schedule-popup .d-schedule-rows-container'), 0, 0)">
       +
      </button>
     </div>
    </div>
    <div class="d-bottom-buttons">
     <button class="d-button" onclick="savePopupSchedule()">
      Save
     </button>
     <button class="d-button" onclick="closePopup(false)">
      Cancel
     </button>
    </div>
    <div class="d-button d-close-button" onclick="closePopup()">
     ✕
    </div>
    <div>
     <input id="d-popup-monthIndex" type="hidden"/>
     <input id="d-popup-dayIndex" type="hidden"/>
    </div>
   </div>
  </div>
  <script>
   const monthNames = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
];

const monthDayCounts = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

function monthIndexToName(monthIndex) {
    return monthNames[monthIndex];
}

function createMonthBlock(monthIndex, onDayClick) {
    let title = "";
    let dayCount = "";

    if (monthIndex >= 0) {
        title = monthIndexToName(monthIndex);
        dayCount = monthDayCounts[monthIndex];
    } else {
        title = "Month";
        dayCount = 31;
    }

    const monthDiv = document.createElement('div');
    monthDiv.className = 'c-month';

    const titleEl = document.createElement('h3');
    titleEl.textContent = title;
    monthDiv.appendChild(titleEl);

    const daysGrid = document.createElement('div');
    daysGrid.className = 'c-days';

    for (let day = 1; day <= dayCount; day++) {
        const dayEl = document.createElement('div');
        dayEl.className = 'c-day';
        dayEl.textContent = day;
        dayEl.addEventListener('click', () => {
            onDayClick(monthIndex, day);
        });
        daysGrid.appendChild(dayEl);
    }

    monthDiv.appendChild(daysGrid);
    return monthDiv;
}

function createMonthCalendar(targetDivClass, monthIndex, onDayClick) {
    const calendarContainers = document.querySelectorAll(`.${targetDivClass}`);
    calendarContainers.forEach(containerEl => {
        containerEl.innerHTML = '';
        const monthEl = createMonthBlock(monthIndex, onDayClick);
        containerEl.appendChild(monthEl);
    });
}

function createYearCalendar(targetDivClass, onDayClick) {
    const calendarContainers = document.querySelectorAll(`.${targetDivClass}`);
    calendarContainers.forEach(containerEl => {
        containerEl.innerHTML = '';
        // const yearDiv = document.createElement('div');
        // yearDiv.className = "c-schedule-container";

        for (let month = 0; month < 12; month++) {
            const monthEl = createMonthBlock(month, onDayClick);
            // yearDiv.appendChild(monthEl);
            containerEl.appendChild(monthEl);
        }

        // containerEl.appendChild(yearDiv);
    });
}

/// -------------

function timeToSeconds(hhmmss) {
    const [h, m, s] = hhmmss.split(':').map(Number);
    return h * 3600 + m * 60 + s;
}

function secondsToTime(seconds) {
    const h = String(Math.floor(seconds / 3600)).padStart(2, '0');
    const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
    const s = String(seconds % 60).padStart(2, '0');
    return `${h}:${m}:${s}`;
}

function createDailyScheduleRow(rowsContainer, secondOfDay, actionType) {
    const row = document.createElement('div');
    row.classList.add('d-schedule-row', 'd-margin-top-10');

    const timeInput = Object.assign(document.createElement('input'), {
        type: 'time',
        step: 1,
        value: secondsToTime(secondOfDay),
    });

    const actionSelect = document.createElement('select');
    actionSelect.innerHTML = `
        <option value="${ActionType.CLOSE_RELAY}">Close Relay</option>
        <option value="${ActionType.OPEN_RELAY}">Open Relay</option>
    `;
    actionSelect.value = actionType;

    const removeBtn = document.createElement('button');
    removeBtn.textContent = '✕';
    removeBtn.className = "d-button";

    removeBtn.addEventListener('click', () => {
        row.remove();
    });

    row.append(timeInput, actionSelect, removeBtn);
    rowsContainer.appendChild(row);
}

function generateDailyScheduleRows(rowsContainer, initialSchedule = []) {
    rowsContainer.innerHTML = "";
    
    initialSchedule.forEach(item => {
        createDailyScheduleRow(rowsContainer, item.daySecond, item.fireAction)
    });
}
  </script>
  <script>
   // Constants for action types
const ActionType = {
    CLOSE_RELAY: 0,
    OPEN_RELAY: 1,
};

// Simple Action class
class Action {
    constructor(type) {
        this.type = type;
    }

    serialize() {
        return new Uint8Array([this.type]);
    }
}

// Represents a single schedule point within a day
class DayScheduleItem {
    constructor(secondOfDay, action) {
        this.secondOfDay = secondOfDay; // integer (0-86399)
        this.action = action; // instance of Action
    }

    serialize() {
        const buffer = new ArrayBuffer(5);
        const view = new DataView(buffer);
        view.setUint32(0, this.secondOfDay, true); // little-endian
        view.setUint8(4, this.action.type);
        return new Uint8Array(buffer);
    }
}

// Holds a list of schedule points for a single day
class DaySchedule {
    constructor() {
        this.items = [];
    }

    addItem(secondOfDay, actionType) {
        this.items.push(new DayScheduleItem(secondOfDay, new Action(actionType)));
    }

    removeItem(index) {
        if (index >= 0 && index < this.items.length) {
            this.items.splice(index, 1);
        }
    }

    clear() {
        this.items = [];
    }

    serialize() {
        const header = new ArrayBuffer(4);
        new DataView(header).setUint32(0, this.items.length, true);
        const itemBuffers = this.items.map(item => item.serialize());
        return new Uint8Array([...new Uint8Array(header), ...itemBuffers.flat()]);
    }
}

// Monthly schedule with 31 day slots
class MonthlySchedule {
    constructor() {
        this.days = Array.from({ length: 31 }, () => new DaySchedule());
    }

    getDaySchedule(dayIndex) {
        if (dayIndex < 0 || dayIndex >= 31) {
            throw new Error("Invalid day index (must be 0–30 for days 1–31)");
        }
        return this.days[dayIndex];
    }

    serialize() {
        const serializedDays = this.days.map(day => day.serialize());
        const totalLength = serializedDays.reduce((sum, arr) => sum + arr.length, 0);
        const output = new Uint8Array(totalLength);

        let offset = 0;
        for (const dayData of serializedDays) {
            output.set(dayData, offset);
            offset += dayData.length;
        }

        return output;
    }
}

class YearlySchedule {
    constructor() {
        this.months = Array.from({ length: 12 }, () => new MonthlySchedule());
    }

    getMonthSchedule(monthIndex) {
        if (monthIndex < 0 || monthIndex >= 12) {
            throw new Error("Invalid month index (must be 0–11 for months 1–12)");
        }
        return this.months[monthIndex];
    }

    serialize() {
        throw new Error("Not implemented.");
    }
}

class Schedule {
    static SCHEDULE_TYPES = ["daily", "monthly", "yearly"];

    constructor(scheduleType = null) {
        this.schedules = {
            daily: new DaySchedule(),
            monthly: new MonthlySchedule(),
            yearly: new YearlySchedule(),
        };
        this.scheduleType = scheduleType;     // "daily", "monthly", etc.
    }

    // Set schedule type and initialize corresponding structure
    setScheduleType(type) {
        if (!Schedule.SCHEDULE_TYPES.includes(type))
            throw new Error(`Unsupported schedule type: ${type}`);

        this.scheduleType = type;
    }

    setDaySchedule({ schedule = [], monthIndex = 0, dayIndex = 0 }) {
        switch (this.scheduleType) {
            case "daily":
                this.schedules.daily.items = schedule;
                break;

            case "monthly":
                this.schedules.monthly.getDaySchedule(dayIndex).items = schedule;
                break;

            case "yearly":
                this.schedules.yearly.getMonthSchedule(monthIndex).getDaySchedule(dayIndex).items = schedule;
                break;

            default:
                throw new Error(`Unsupported operation for current schedule type: ${this.scheduleType}`);
        }
    }

    setSchedule(schedule) {
        switch (this.scheduleType) {
            case "daily":
                this.schedules.daily.items = schedule;
                break;

            case "monthly":
                if (schedule.length != 31)
                    throw new RangeError("A monthly schedule should have 31 items.");

                this.schedules.monthly.items = schedule;
                break;

            case "yearly":
                if (schedule.length != 12)
                    throw new RangeError("A yearly schedule should have 12 items.");

                this.schedules.yearly.items = schedule;
                break;

            default:
                throw new Error(`Unsupported operation for current schedule type: ${this.scheduleType}`);
        }
    }

    // Add a schedule point
    // addItem({ dayIndex = 0, secondOfDay, actionType }) {
    //     switch (this.scheduleType) {
    //         case "daily":
    //             this.schedules.daily.addItem(secondOfDay, actionType);
    //             break;

    //         case "monthly":
    //             this.schedules.monthly.getDaySchedule(dayIndex).addItem(secondOfDay, actionType);
    //             break;

    //         default:
    //             throw new Error(`Unsupported operation for current schedule type: ${this.scheduleType}`);
    //     }
    // }

    // Remove an item by index (and dayIndex for monthly)
    // removeItem({ dayIndex = 0, itemIndex }) {
    //     switch (this.scheduleType) {
    //         case "daily":
    //             this.schedules.daily.removeItem(itemIndex);
    //             break;

    //         case "monthly":
    //             this.schedules.monthly.getDaySchedule(dayIndex).removeItem(itemIndex);
    //             break;

    //         default:
    //             throw new Error(`Unsupported operation for current schedule type: ${this.scheduleType}`);
    //     }
    // }

    // Clear the schedule
    // clear() {
    //     switch (this.scheduleType) {
    //         case "daily":
    //             this.schedules.daily.clear();
    //             break;

    //         case "monthly":
    //             this.schedules.monthly.forEach(day => day.clear());
    //             break;

    //         default:
    //             throw new Error(`Unsupported operation for current schedule type: ${this.scheduleType}`);
    //     }
    // }

    // Access schedule items
    getDaySchedule({ monthIndex = 0, dayIndex = 0 }) {
        switch (this.scheduleType) {
            case "daily":
                return this.schedules.daily.items;

            case "monthly":
                return this.schedules.monthly.getDaySchedule(dayIndex).items;

            case "yearly":
                return this.schedules.yearly.getMonthSchedule(monthIndex).getDaySchedule(dayIndex).items;

            default:
                throw new Error(`Unsupported operation for current schedule type: ${this.scheduleType}`);
        }
    }

    // Serialize entire schedule
    serialize() {
        return this.schedules[this.scheduleType].serialize();
    }

    // Debug print
    print() {
        console.log(`Current schedule type: ${this.scheduleType}`);

        if (this.scheduleType === "daily") {
            this.schedules.daily.items.forEach((item, idx) =>
                console.log(`[${idx}] ${item.secondOfDay}s → Action ${item.action.type}`)
            );
        } else if (this.scheduleType === "monthly") {
            this.schedules.monthly.days.forEach((day, d) => {
                console.log(`Day ${d + 1}:`);
                day.items.forEach((item, i) =>
                    console.log(`  [${i}] ${item.secondOfDay}s → Action ${item.action.type}`)
                );
            });
        }
    }
}

window.Schedule = Schedule
  </script>
  <script>
   function updateTime() {
    fetch('/get_time')
        .then(response => response.text())
        .then(timeString => {
            const date = new Date(timeString);
            const formattedTime = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById("timeDisplay").textContent = "System Time: " + formattedTime;
        })
        .catch(error => {
            console.error("Error fetching time:", error);
            document.getElementById("timeDisplay").textContent = "System Time: Error loading time";
        });
}

function fetchSchedule() {
    return getSchedulePlacholder();
    // fetch('/get_schedule')
    //     .then(response => response.arrayBuffer())
    //     .then(data => {
    //         let schedule = decodeScheduleToJson(data);
    //         console.log(schedule);
    //         // const tableBody = document.getElementById("scheduleTable").getElementsByTagName("tbody")[0];
    //         // tableBody.innerHTML = ""; // Clear existing rows
    //         // data.schedule_items.forEach(item => {
    //         //     const hour = Math.floor(item.time / 60).toString().padStart(2, '0');
    //         //     const minute = (item.time % 60).toString().padStart(2, '0');
    //         //     addScheduleRow(`${hour}:${minute}`, item.type);
    //         // });
    //     })
    //     .catch(error => console.error('Error fetching schedule:', error));
}

function decodeScheduleToJson(rawBuffer) {
    const dataView = new DataView(rawBuffer);
    let result = {};

    let scheduleType = dataView.getUint8(0);
    switch (scheduleType) {
        case 1:
            result.scheduleType = 'daily';
            result.schedule = decodeDailySchedule(new DataView(dataView.buffer, 1));

        case 2:
            // return 'weeky';
            break;

        case 3:
            result.scheduleType = 'monthly';
            result.schedule = decodeMonthlySchedule(new DataView(dataView.buffer, 1));

        case 4:
            // return 'yearly';
            break;

        case 5:
            // return 'custom';
            break;

        default:
            return null;
    }

    return result;
}

/**
 * 
 * @param {Dataview} dataView 
 * @returns 
 */
function decodeDailySchedule(dataView) {
    let itemsCount = dataView.getUint32(0, true);

    let result = [];
    let byteOffset = 4;
    for (let index = 0; index < itemsCount; ++index) {
        result.push({
            daySecond: dataView.getUint32(byteOffset, true),
            fireAction: dataView.getUint8(byteOffset + 4)
        });
        byteOffset += 5;
    }

    return { schedule: result, bytesRead: byteOffset };
}

/**
 * @param {DataView} dataView 
 */
function decodeMonthlySchedule(dataView) {
    let result = [];
    let byteOffset = 0;

    for (let index = 0; index < 31; index++) {
        let parseResult = decodeDailySchedule(new DataView(dataView.buffer, dataView.byteOffset + byteOffset));
        result.push(parseResult.schedule);
        byteOffset += parseResult.bytesRead;
    }

    return result;
}

function getSchedulePlacholder() {
    return {
        scheduleType: "monthly",
        schedule: [
            [
                {
                    "daySecond": 2730,
                    "fireAction": 0
                },
                {
                    "daySecond": 5078,
                    "fireAction": 1
                },
                {
                    "daySecond": 5370,
                    "fireAction": 1
                },
                {
                    "daySecond": 5871,
                    "fireAction": 1
                },
                {
                    "daySecond": 7363,
                    "fireAction": 0
                }
            ],
            [
                {
                    "daySecond": 1896,
                    "fireAction": 0
                },
                {
                    "daySecond": 3739,
                    "fireAction": 0
                },
                {
                    "daySecond": 5514,
                    "fireAction": 1
                },
                {
                    "daySecond": 7998,
                    "fireAction": 1
                },
                {
                    "daySecond": 9685,
                    "fireAction": 1
                },
                {
                    "daySecond": 12399,
                    "fireAction": 1
                },
                {
                    "daySecond": 13731,
                    "fireAction": 0
                },
                {
                    "daySecond": 14311,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 941,
                    "fireAction": 1
                },
                {
                    "daySecond": 2057,
                    "fireAction": 1
                },
                {
                    "daySecond": 4563,
                    "fireAction": 0
                },
                {
                    "daySecond": 5603,
                    "fireAction": 0
                },
                {
                    "daySecond": 8431,
                    "fireAction": 0
                }
            ],
            [
                {
                    "daySecond": 2350,
                    "fireAction": 0
                },
                {
                    "daySecond": 5193,
                    "fireAction": 1
                },
                {
                    "daySecond": 7266,
                    "fireAction": 0
                },
                {
                    "daySecond": 7557,
                    "fireAction": 1
                },
                {
                    "daySecond": 7817,
                    "fireAction": 0
                },
                {
                    "daySecond": 9554,
                    "fireAction": 0
                }
            ],
            [
                {
                    "daySecond": 2517,
                    "fireAction": 1
                },
                {
                    "daySecond": 4271,
                    "fireAction": 0
                },
                {
                    "daySecond": 4425,
                    "fireAction": 1
                },
                {
                    "daySecond": 7206,
                    "fireAction": 0
                },
                {
                    "daySecond": 7866,
                    "fireAction": 1
                },
                {
                    "daySecond": 9901,
                    "fireAction": 0
                },
                {
                    "daySecond": 12507,
                    "fireAction": 1
                },
                {
                    "daySecond": 15069,
                    "fireAction": 1
                },
                {
                    "daySecond": 16621,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 2290,
                    "fireAction": 1
                },
                {
                    "daySecond": 2808,
                    "fireAction": 0
                },
                {
                    "daySecond": 6269,
                    "fireAction": 1
                },
                {
                    "daySecond": 6276,
                    "fireAction": 0
                },
                {
                    "daySecond": 8730,
                    "fireAction": 0
                }
            ],
            [
                {
                    "daySecond": 457,
                    "fireAction": 1
                },
                {
                    "daySecond": 2926,
                    "fireAction": 1
                },
                {
                    "daySecond": 4630,
                    "fireAction": 1
                },
                {
                    "daySecond": 4644,
                    "fireAction": 0
                },
                {
                    "daySecond": 7650,
                    "fireAction": 1
                },
                {
                    "daySecond": 8664,
                    "fireAction": 1
                },
                {
                    "daySecond": 9288,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 1754,
                    "fireAction": 0
                },
                {
                    "daySecond": 3295,
                    "fireAction": 1
                },
                {
                    "daySecond": 5558,
                    "fireAction": 0
                },
                {
                    "daySecond": 8696,
                    "fireAction": 0
                },
                {
                    "daySecond": 12168,
                    "fireAction": 1
                },
                {
                    "daySecond": 13419,
                    "fireAction": 0
                }
            ],
            [
                {
                    "daySecond": 3153,
                    "fireAction": 1
                },
                {
                    "daySecond": 6164,
                    "fireAction": 1
                },
                {
                    "daySecond": 8733,
                    "fireAction": 0
                },
                {
                    "daySecond": 8997,
                    "fireAction": 1
                },
                {
                    "daySecond": 12424,
                    "fireAction": 0
                },
                {
                    "daySecond": 14070,
                    "fireAction": 0
                },
                {
                    "daySecond": 17346,
                    "fireAction": 1
                },
                {
                    "daySecond": 19368,
                    "fireAction": 0
                },
                {
                    "daySecond": 22606,
                    "fireAction": 0
                },
                {
                    "daySecond": 24665,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 1928,
                    "fireAction": 1
                },
                {
                    "daySecond": 5014,
                    "fireAction": 1
                },
                {
                    "daySecond": 7878,
                    "fireAction": 1
                },
                {
                    "daySecond": 8165,
                    "fireAction": 1
                },
                {
                    "daySecond": 11516,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 579,
                    "fireAction": 1
                },
                {
                    "daySecond": 3495,
                    "fireAction": 1
                },
                {
                    "daySecond": 6484,
                    "fireAction": 1
                },
                {
                    "daySecond": 6894,
                    "fireAction": 0
                },
                {
                    "daySecond": 8441,
                    "fireAction": 0
                },
                {
                    "daySecond": 9985,
                    "fireAction": 1
                },
                {
                    "daySecond": 10719,
                    "fireAction": 0
                },
                {
                    "daySecond": 12214,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 3175,
                    "fireAction": 1
                },
                {
                    "daySecond": 6221,
                    "fireAction": 1
                },
                {
                    "daySecond": 6572,
                    "fireAction": 1
                },
                {
                    "daySecond": 8045,
                    "fireAction": 1
                },
                {
                    "daySecond": 9621,
                    "fireAction": 1
                },
                {
                    "daySecond": 10416,
                    "fireAction": 1
                },
                {
                    "daySecond": 12273,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 2138,
                    "fireAction": 1
                },
                {
                    "daySecond": 4755,
                    "fireAction": 1
                },
                {
                    "daySecond": 6103,
                    "fireAction": 0
                },
                {
                    "daySecond": 6550,
                    "fireAction": 0
                },
                {
                    "daySecond": 7582,
                    "fireAction": 0
                },
                {
                    "daySecond": 9832,
                    "fireAction": 1
                },
                {
                    "daySecond": 10809,
                    "fireAction": 0
                },
                {
                    "daySecond": 14377,
                    "fireAction": 0
                },
                {
                    "daySecond": 16458,
                    "fireAction": 0
                },
                {
                    "daySecond": 19666,
                    "fireAction": 0
                }
            ],
            [
                {
                    "daySecond": 1245,
                    "fireAction": 0
                },
                {
                    "daySecond": 2114,
                    "fireAction": 1
                },
                {
                    "daySecond": 3932,
                    "fireAction": 1
                },
                {
                    "daySecond": 4197,
                    "fireAction": 1
                },
                {
                    "daySecond": 5909,
                    "fireAction": 0
                },
                {
                    "daySecond": 7543,
                    "fireAction": 1
                },
                {
                    "daySecond": 10972,
                    "fireAction": 0
                },
                {
                    "daySecond": 11504,
                    "fireAction": 0
                },
                {
                    "daySecond": 12123,
                    "fireAction": 0
                },
                {
                    "daySecond": 12224,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 226,
                    "fireAction": 0
                },
                {
                    "daySecond": 1307,
                    "fireAction": 1
                },
                {
                    "daySecond": 2406,
                    "fireAction": 1
                },
                {
                    "daySecond": 4961,
                    "fireAction": 0
                },
                {
                    "daySecond": 6780,
                    "fireAction": 1
                },
                {
                    "daySecond": 7204,
                    "fireAction": 1
                },
                {
                    "daySecond": 7739,
                    "fireAction": 0
                }
            ],
            [
                {
                    "daySecond": 384,
                    "fireAction": 0
                },
                {
                    "daySecond": 1814,
                    "fireAction": 1
                },
                {
                    "daySecond": 4813,
                    "fireAction": 0
                },
                {
                    "daySecond": 8117,
                    "fireAction": 1
                },
                {
                    "daySecond": 10485,
                    "fireAction": 0
                },
                {
                    "daySecond": 11303,
                    "fireAction": 0
                },
                {
                    "daySecond": 13644,
                    "fireAction": 0
                },
                {
                    "daySecond": 16711,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 1041,
                    "fireAction": 1
                },
                {
                    "daySecond": 1517,
                    "fireAction": 1
                },
                {
                    "daySecond": 3295,
                    "fireAction": 0
                },
                {
                    "daySecond": 5750,
                    "fireAction": 0
                },
                {
                    "daySecond": 7546,
                    "fireAction": 1
                },
                {
                    "daySecond": 11036,
                    "fireAction": 1
                },
                {
                    "daySecond": 12406,
                    "fireAction": 0
                },
                {
                    "daySecond": 15571,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 2558,
                    "fireAction": 1
                },
                {
                    "daySecond": 5481,
                    "fireAction": 1
                },
                {
                    "daySecond": 9064,
                    "fireAction": 0
                },
                {
                    "daySecond": 11978,
                    "fireAction": 0
                },
                {
                    "daySecond": 15010,
                    "fireAction": 1
                },
                {
                    "daySecond": 15925,
                    "fireAction": 0
                },
                {
                    "daySecond": 19022,
                    "fireAction": 1
                },
                {
                    "daySecond": 19826,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 394,
                    "fireAction": 1
                },
                {
                    "daySecond": 2484,
                    "fireAction": 0
                },
                {
                    "daySecond": 4037,
                    "fireAction": 1
                },
                {
                    "daySecond": 5078,
                    "fireAction": 0
                },
                {
                    "daySecond": 5796,
                    "fireAction": 1
                },
                {
                    "daySecond": 7120,
                    "fireAction": 0
                },
                {
                    "daySecond": 9385,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 3517,
                    "fireAction": 0
                },
                {
                    "daySecond": 4858,
                    "fireAction": 0
                },
                {
                    "daySecond": 7909,
                    "fireAction": 0
                },
                {
                    "daySecond": 8328,
                    "fireAction": 1
                },
                {
                    "daySecond": 10397,
                    "fireAction": 1
                },
                {
                    "daySecond": 11853,
                    "fireAction": 0
                },
                {
                    "daySecond": 14587,
                    "fireAction": 0
                },
                {
                    "daySecond": 14896,
                    "fireAction": 0
                },
                {
                    "daySecond": 15619,
                    "fireAction": 0
                },
                {
                    "daySecond": 15827,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 1244,
                    "fireAction": 1
                },
                {
                    "daySecond": 2136,
                    "fireAction": 1
                },
                {
                    "daySecond": 3859,
                    "fireAction": 1
                },
                {
                    "daySecond": 5635,
                    "fireAction": 0
                },
                {
                    "daySecond": 5762,
                    "fireAction": 0
                }
            ],
            [
                {
                    "daySecond": 2665,
                    "fireAction": 1
                },
                {
                    "daySecond": 5923,
                    "fireAction": 0
                },
                {
                    "daySecond": 6988,
                    "fireAction": 0
                },
                {
                    "daySecond": 7197,
                    "fireAction": 1
                },
                {
                    "daySecond": 7645,
                    "fireAction": 1
                },
                {
                    "daySecond": 10727,
                    "fireAction": 1
                },
                {
                    "daySecond": 11852,
                    "fireAction": 0
                },
                {
                    "daySecond": 14003,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 1966,
                    "fireAction": 0
                },
                {
                    "daySecond": 2301,
                    "fireAction": 0
                },
                {
                    "daySecond": 2997,
                    "fireAction": 1
                },
                {
                    "daySecond": 3637,
                    "fireAction": 1
                },
                {
                    "daySecond": 5031,
                    "fireAction": 0
                }
            ],
            [
                {
                    "daySecond": 2850,
                    "fireAction": 0
                },
                {
                    "daySecond": 3941,
                    "fireAction": 0
                },
                {
                    "daySecond": 4281,
                    "fireAction": 0
                },
                {
                    "daySecond": 7065,
                    "fireAction": 1
                },
                {
                    "daySecond": 8588,
                    "fireAction": 0
                }
            ],
            [
                {
                    "daySecond": 2191,
                    "fireAction": 0
                },
                {
                    "daySecond": 4190,
                    "fireAction": 0
                },
                {
                    "daySecond": 6896,
                    "fireAction": 0
                },
                {
                    "daySecond": 10376,
                    "fireAction": 0
                },
                {
                    "daySecond": 12294,
                    "fireAction": 1
                },
                {
                    "daySecond": 13098,
                    "fireAction": 0
                },
                {
                    "daySecond": 16105,
                    "fireAction": 0
                },
                {
                    "daySecond": 18978,
                    "fireAction": 1
                },
                {
                    "daySecond": 21961,
                    "fireAction": 0
                }
            ],
            [
                {
                    "daySecond": 2212,
                    "fireAction": 1
                },
                {
                    "daySecond": 4439,
                    "fireAction": 1
                },
                {
                    "daySecond": 6718,
                    "fireAction": 1
                },
                {
                    "daySecond": 8317,
                    "fireAction": 0
                },
                {
                    "daySecond": 10970,
                    "fireAction": 1
                },
                {
                    "daySecond": 14333,
                    "fireAction": 0
                },
                {
                    "daySecond": 17362,
                    "fireAction": 1
                },
                {
                    "daySecond": 19572,
                    "fireAction": 1
                },
                {
                    "daySecond": 20915,
                    "fireAction": 0
                },
                {
                    "daySecond": 21015,
                    "fireAction": 0
                }
            ],
            [
                {
                    "daySecond": 1001,
                    "fireAction": 1
                },
                {
                    "daySecond": 1763,
                    "fireAction": 0
                },
                {
                    "daySecond": 4162,
                    "fireAction": 0
                },
                {
                    "daySecond": 6015,
                    "fireAction": 0
                },
                {
                    "daySecond": 6196,
                    "fireAction": 1
                },
                {
                    "daySecond": 7417,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 3160,
                    "fireAction": 0
                },
                {
                    "daySecond": 4956,
                    "fireAction": 1
                },
                {
                    "daySecond": 6874,
                    "fireAction": 1
                },
                {
                    "daySecond": 8315,
                    "fireAction": 0
                },
                {
                    "daySecond": 9724,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 3380,
                    "fireAction": 1
                },
                {
                    "daySecond": 4975,
                    "fireAction": 0
                },
                {
                    "daySecond": 6309,
                    "fireAction": 1
                },
                {
                    "daySecond": 8021,
                    "fireAction": 0
                },
                {
                    "daySecond": 9734,
                    "fireAction": 1
                },
                {
                    "daySecond": 13223,
                    "fireAction": 1
                },
                {
                    "daySecond": 13371,
                    "fireAction": 1
                },
                {
                    "daySecond": 13476,
                    "fireAction": 0
                },
                {
                    "daySecond": 17017,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 1567,
                    "fireAction": 1
                },
                {
                    "daySecond": 3240,
                    "fireAction": 1
                },
                {
                    "daySecond": 4273,
                    "fireAction": 1
                },
                {
                    "daySecond": 6604,
                    "fireAction": 1
                },
                {
                    "daySecond": 8785,
                    "fireAction": 1
                },
                {
                    "daySecond": 10111,
                    "fireAction": 1
                }
            ],
            [
                {
                    "daySecond": 3487,
                    "fireAction": 1
                },
                {
                    "daySecond": 6777,
                    "fireAction": 1
                },
                {
                    "daySecond": 6868,
                    "fireAction": 0
                },
                {
                    "daySecond": 9240,
                    "fireAction": 1
                },
                {
                    "daySecond": 12402,
                    "fireAction": 0
                }
            ]
        ]
    }
}

// function submitSchedule(scheduleFormId) {
//     const form = document.getElementById(scheduleFormId);
//     const times = Array.from(form.querySelectorAll("input[name='time[]']")).map(input => input.value);
//     const types = Array.from(form.querySelectorAll("select[name='type[]']")).map(select => select.value);

//     const schedule_items = times.map((time, index) => {
//         const [hour, minute] = time.split(":").map(Number);
//         return {
//             time: hour * 60 + minute,
//             type: types[index] === "single" ? 1 : types[index] === "double" ? 2 : 3
//         };
//     });

//     const jsonData = {
//         schedule_items: schedule_items
//     };

//     console.log(JSON.stringify(jsonData, null, 2));

//     fetch('/update_schedule', {
//         method: 'POST',
//         headers: {
//             'Content-Type': 'application/json'
//         },
//         body: JSON.stringify(jsonData)
//     })
//         .then(response => response.text())
//         .then(data => console.log('Server Response:', data))
//         .catch(error => console.error('Error:', error));
// }

// function fetchSchedule() {
//     fetch('/get_schedule')
//         .then(response => response.json())
//         .then(data => {
//             const tableBody = document.getElementById("scheduleTable").getElementsByTagName("tbody")[0];
//             tableBody.innerHTML = ""; // Clear existing rows
//             data.schedule_items.forEach(item => {
//                 const hour = Math.floor(item.time / 60).toString().padStart(2, '0');
//                 const minute = (item.time % 60).toString().padStart(2, '0');
//                 addScheduleRow(`${hour}:${minute}`, item.type);
//             });
//         })
//         .catch(error => console.error('Error fetching schedule:', error));
// }

// function submitSettings() {
//     if (!confirm("Wi-Fi will restart after settings are applied. Do you want to proceed?")) {
//         return;
//     }

//     const form = document.getElementById("settingsForm");
//     const jsonData = {
//         wifi_ssid: form.wifi_ssid.value,
//         wifi_password: form.wifi_password.value,
//         remote_wifi_ssid: form.remote_wifi_ssid.value,
//         remote_wifi_password: form.remote_wifi_password.value,
//         timezone: form.timezone.value
//     };

//     console.log(JSON.stringify(jsonData, null, 2));

//     fetch('/update_settings', {
//         method: 'POST',
//         headers: {
//             'Content-Type': 'application/json'
//         },
//         body: JSON.stringify(jsonData)
//     })
//         .then(response => {
//             if (!response.ok) {
//                 throw new Error('Failed to update settings');
//             }
//             return response.text();
//         })
//         .then(data => console.log('Server Response:', data))
//         .catch(error => {
//             console.error('Error:', error);
//             alert('Error updating settings: ' + error.message);
//         });
// }

// function fetchSettings() {
//     fetch('/get_settings')
//         .then(response => response.json())
//         .then(data => {
//             document.getElementById("wifi_ssid").value = data.wifi_ssid || "";
//             document.getElementById("wifi_password").value = data.wifi_password || "";
//             document.getElementById("remote_wifi_ssid").value = data.remote_wifi_ssid || "";
//             document.getElementById("remote_wifi_password").value = data.remote_wifi_password || "";
//             document.getElementById("timezone").value = data.timezone || "";
//         })
//         .catch(error => {
//             console.error('Error fetching settings:', error);
//             // alert('Error fetching settings: ' + error.message);
//         });
// }
  </script>
  <script>
   const POPUP_WINDOW_ID = "d-day-schedule-popup";

const schedule = new Schedule();


function showTab(tabId) {
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });

    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });

    document.querySelector(`.tab[onclick*="${tabId}"]`).classList.add('active');
    document.getElementById(tabId).classList.add('active');
}

function scheduleTypeSelectChanged() {
    const newType = document.getElementById("schedule-loop-type").value;
    const targetClass = `d-${newType}-view`;
    console.log(targetClass);

    const viewsHolder = document.getElementById("d-schedule-views");
    // console.log(viewsHolder.children);
    for (view of viewsHolder.children) {
        const viewClassList = view.classList;

        if (viewClassList.contains(targetClass)) {
            viewClassList.remove("d-hidden");
            continue;
        }

        view.classList.add("d-hidden");
    }

    schedule.setScheduleType(newType);
}

function onYearlyDayClick(month, day) {
    if (schedule.scheduleType != "yearly") {
        throw TypeError("onDayClick event fired for the yearly schedule when current schedule type is not yearly.");
    }

    showPopup({ monthIndex: month, dayIndex: day });
}

function onMonthlyDayClick(_, day) {
    if (schedule.scheduleType != "monthly") {
        throw TypeError("onDayClick event fired for the monthly schedule when current schedule type is not monthly.");
    }

    showPopup({ dayIndex: day });
}

function showPopup({ monthIndex = -1, dayIndex = 0 }) {
    document.getElementById(POPUP_WINDOW_ID).classList.remove("d-hidden");
    const rowsContainer = document.querySelector(`#${POPUP_WINDOW_ID} .d-schedule-rows-container`);
    const storedSchedule = schedule.getDaySchedule({ monthIndex: monthIndex, dayIndex: dayIndex });
    generateDailyScheduleRows(rowsContainer, (storedSchedule != undefined && storedSchedule.length != 0) ? storedSchedule : [{ daySecond: 0, fireAction: 0 }]);

    let headerText;
    if (monthIndex >= 0)
        headerText = `${monthIndexToName(monthIndex)} ${dayIndex}`;
    else
        headerText = `Day: ${dayIndex}`

    const editorHeader = document.querySelector(`#${POPUP_WINDOW_ID} #popup-header`);
    editorHeader.innerHTML = headerText;

    document.querySelector(`#${POPUP_WINDOW_ID} #d-popup-monthIndex`).value = monthIndex;
    document.querySelector(`#${POPUP_WINDOW_ID} #d-popup-dayIndex`).value = dayIndex;
}

function closePopup(promptConfirm = true) {
    // check if the confirmation should be asked, then, if confirmation declined, skip the closing process
    if (promptConfirm && !confirm("Close the editor without saving?")) {
        return;
    }

    document.getElementById(POPUP_WINDOW_ID).classList.add("d-hidden");
}

function savePopupSchedule() {
    const scheduleRows = document.querySelectorAll(`#${POPUP_WINDOW_ID} .d-schedule-row`);
    console.log(scheduleRows);

    const newDayschedule = [];
    scheduleRows.forEach(scheduleRow => {
        const time = scheduleRow.children[0].value;
        const action = scheduleRow.children[1].value;

        newDayschedule.push({
            daySecond: timeToSeconds(time),
            fireAction: action
        });
    });

    newDayschedule.sort((lhs, rhs) => {
        if (rhs.daySecond > lhs.daySecond)
            return -1
        else if (rhs.daySecond < lhs.daySecond)
            return 1

        return 0;
    });

    const monthIndex = document.querySelector(`#${POPUP_WINDOW_ID} #d-popup-monthIndex`).value;
    const dayIndex = document.querySelector(`#${POPUP_WINDOW_ID} #d-popup-dayIndex`).value;

    // console.log(`Day index: ${dayIndex}, Month index: ${monthIndex}`);

    schedule.setDaySchedule({
        schedule: newDayschedule,
        monthIndex: Number(monthIndex),
        dayIndex: Number(dayIndex)
    });

    closePopup(promptConfirm = false);
}

function loadSchedule() {
    const deviceSchedule = fetchSchedule();
    schedule.setScheduleType(deviceSchedule.scheduleType);
    schedule.setSchedule(deviceSchedule.schedule);

    generateDailyScheduleRows(
        document.querySelector(`.d-daily-view .d-schedule-rows-container`),
        (deviceSchedule.scheduleType === "daily") ? storedSchedule : [{ daySecond: 0, fireAction: 0 }]
    );

    document.getElementById("schedule-loop-type").value = deviceSchedule.scheduleType;

    scheduleTypeSelectChanged();
}
  </script>
  <script>
   createMonthCalendar("d-monthly-view .c-schedule-container", -1, onMonthlyDayClick)
        createYearCalendar("d-yearly-view .c-schedule-container", onYearlyDayClick);

        loadSchedule();
  </script>
 </body>
</html>
